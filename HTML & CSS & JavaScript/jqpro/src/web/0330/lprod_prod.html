<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="../css/public.css">

<script src="../js/jquery-3.6.0.min.js"></script>

<script>
   $(function(){
      $('#btn1').on('click', function(){
         $.ajax({
            url : '/jqpro/LprodServlet.do',
            type : 'get',
            
            success : function(res){
               str = "";
               
               $.each(res, function(i, v){
                  str += "<option value='" + v.gu + "'>" + v.nm + " </option>"
               })
               
               $('#lprod').html(str);
               $('#lprod').trigger('change');
               
            },
            error : function(xhr){
               alert("상태 : " + xhr.status)
            },
            dataType : 'json'
         })
      })
      
      //---------------------------------------------------------------------
      
      // lprod를 선택하면 lprod_gu값을 얻어서 server로 전송 -> prod_id, prod_name을 출력
      // 데이터가 없는 prod를 선택하면 '데이터없음'으로 뜬다.
      $('#lprod').on('change', function(){
         lgu = $('option:selected', this).val();
         $.ajax({
            url : '/jqpro/ProdServlet.do',
            type : 'get',
            data : {"lgu" : lgu},
            
            success : function(res){
               
               str = "";
               
               if(res.length > 0){   
                  
                  $.each(res, function(i, v){
                     
                     str += "<option value='" + v.prod_id + "'>" + v.prod_name + "</option>"
                  })
               }else{
                  str += "<option value='0'>데이터없음</option>";
                  $('#result1').empty();
                  
               }
               
               $('#prod').html(str);
               $('#prod').trigger('change');
               
            },
            error : function(xhr){
               alert("상태 : " + xhr.status)
            },
            dataType : 'json'
         })
      })
      
      //---------------------------------------------------------------------
      
      // prod를 선택하면 option value에 있는 prod_id를 얻어서 서버로 보낸다. -> 결과를 result1에 출력한다.
      // option value값이 0이면 서버로 보내지않고 -> result1에 있는 내용을 지운다. (remove(X), empty(O))
      // prod_id를 조건으로 하는 prodDetail출력(제품상세보기)
      $('#prod').on('change', function(){
         
         // prod의 선택한 항목의 option value값 -> prod_id 값을 가져온다.
         id = $('option:selected', this).val();
         
         // option value(=prod_id)값이 0인지 아닌지 판단 (0이 아니면 서버로 보냄)
         if(id != 0){
            // 서버로 보냄
            $.ajax({
               url : '/jqpro/ProdServlet.do',
               type : 'post',
               data : {"id": id},
               
               success : function(res){
                  str = "<table>";
                  
                  str += "<tr><td>PROD_ID</td>";
                  str += "<td>" + res.prod_id + "</td><tr>";
                  
                  str += "<tr><td>PROD_NAME</td>";
                  str += "<td>" + res.prod_name + "</td><tr>";
                  
                  str += "<tr><td>PROD_LGU</td>";
                  str += "<td>" + res.prod_lgu + "</td><tr>";
                  
                  str += "<tr><td>PROD_BUYER</td>";
                  str += "<td>" + res.prod_buyer + "</td><tr>";
                  
                  str += "<tr><td>PROD_COST</td>";
                  str += "<td>" + res.prod_cost + "</td><tr>";
                  
                  str += "<tr><td>PROD_PRICE</td>";
                  str += "<td>" + res.prod_price + "</td><tr>";
                  
                  str += "<tr><td>PROD_SALE</td>";
                  str += "<td>" + res.prod_sale + "</td><tr>";
                  
                  str += "<tr><td>PROD_SIZE</td>";
                  str += "<td>" + res.prod_size + "</td><tr>";
                  
                  str += "<tr><td>PROD_COLOR</td>";
                  str += "<td>" + res.prod_color + "</td><tr>";
                  
                  str += "</table>";
                  $('#result1').html(str);
               },
               error : function(xhr){
                  alert("상태 : " + xhr.status)
               },
               dataType : 'json'
            })
            
         }
         
      })
   })
</script>

<style>
</style>

</head>
<body>

   <div class="box">
      <pre>
       </pre>
       <input type="button" value="확인" id="btn1">
       
<!--        <select id="lprod"></select> -->
<!--        <select id="prod"></select> -->

      <div class="container">
        <h2>lprod_prod</h2>
        <form>
          <div class="form-group">
            <label for="lprod">lprod list</label>
            <select class="form-control" id="lprod" name="sellist1">
            </select>
            <br>
            <label for="prod">prod list</label>
            <select class="form-control" id="prod" name="sellist2">
            </select>
          </div>
        </form>
      </div>
      
       
       <div id="result1"></div>
   </div>
</body>
</html>